package com.suppliq.manufacturepro.Controllers;

import com.suppliq.manufacturepro.Base.AppInitializer;
import com.suppliq.manufacturepro.Base.AppView;
import com.suppliq.manufacturepro.Base.BenchmarkTimer;
import com.suppliq.manufacturepro.Base.NavigationManager;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.control.Label;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.HBox;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;

import static com.suppliq.manufacturepro.Utils.Utilities.storeName;

public class MainController {



    @FXML
    private BorderPane mainPane;

    @FXML
    private ImageView logo;

    @FXML
    private Label storeNameLabel;



    @FXML
    public void initialize() {
        // ×˜×¢×Ÿ ×œ×•×’×• ×•×©× ×—× ×•×ª
        logo.setImage(new Image(getClass().getResourceAsStream("/com/suppliq/manufacturepro/Images/logo.png")));
        storeNameLabel.setText(storeName);

        AppInitializer.initializeApp();

        NavigationManager.setMainContainer(mainPane);
        showProducts();
    }
    @FXML
    private void showHome() {
        NavigationManager.goTo(AppView.HOME);
    }

    @FXML
    private void showProducts() {
        BenchmarkTimer.markStart("××¢×‘×¨ ×œ×¢××•×“ ××•×¦×¨×™×");
        NavigationManager.goTo(AppView.PRODUCTS);
        BenchmarkTimer.markEnd("××¢×‘×¨ ×œ×¢××•×“ ××•×¦×¨×™×");
        BenchmarkTimer.printResults();
    }

    @FXML
    private void reloadFromSource() {
        try {
            // ×˜×¢×Ÿ ××ª ×”Ö¾FXML ×”××§×•×¨×™
            Path sourcePath = Paths.get("src/main/resources/com/suppliq/manufacturepro/Views/product-view.fxml");
            FXMLLoader loader = new FXMLLoader(sourcePath.toUri().toURL());
            Node view = loader.load();
            mainPane.setCenter(view);

            // ×˜×¢×Ÿ ××ª ×”Ö¾CSS ×”××§×•×¨×™ â†’ ×¦×•×¨ ×¢×•×ª×§ ×–×× ×™
            Path originalCss = Paths.get("src/main/resources/com/suppliq/manufacturepro/Styles/product-style.css");
            String tempFileName = "product-style-temp-" + System.currentTimeMillis() + ".css";
            Path tempCss = Paths.get("src/main/resources/com/suppliq/manufacturepro/Styles/" + tempFileName);

            Files.copy(originalCss, tempCss, StandardCopyOption.REPLACE_EXISTING);

            // ×˜×¢×Ÿ ××ª ×”×¢×•×ª×§ ×¢× ×©× ×—×“×©
            Parent root = (Parent) mainPane.getCenter();
            root.getStylesheets().clear();
            root.getStylesheets().add(tempCss.toUri().toString());

            System.out.println("âœ… Reloaded view + CSS from fresh file: " + tempFileName);

        } catch (IOException e) {
            e.printStackTrace();
            System.err.println("âŒ Failed to reload view or CSS.");
        }
    }

    private void cleanTempCssFiles() {
        try {
            Path cssDir = Paths.get("src/main/resources/com/suppliq/manufacturepro/Styles");
            Files.list(cssDir)
                    .filter(path -> path.getFileName().toString().startsWith("product-style-temp-"))
                    .forEach(path -> {
                        try {
                            Files.delete(path);
                            System.out.println("ğŸ§¹ × ××—×§: " + path.getFileName());
                        } catch (IOException e) {
                            System.err.println("âš ï¸ ×œ× × ×™×ª×Ÿ ×œ××—×•×§: " + path.getFileName());
                        }
                    });
        } catch (IOException e) {
            e.printStackTrace();
        }
    }








}
